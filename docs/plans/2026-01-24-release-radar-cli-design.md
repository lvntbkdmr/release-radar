# release-radar-cli Design

## Overview

**release-radar-cli** is a companion npm package to ReleaseRadar that enables downloading monitored tools on an intranet through a corporate Nexus proxy.

### Problem

When ReleaseRadar detects a version update and sends a Telegram notification, downloading the tool on an intranet machine requires manually:
1. Finding the download URL
2. Constructing the wget command with the Nexus proxy prefix
3. Running the command

This is tedious and error-prone.

### Solution

A two-part system:
1. **ReleaseRadar** publishes an npm package containing version info and download URLs
2. **release-radar-cli** (installed via npm on intranet) provides an interactive menu to select and download tools

## Architecture

```
┌─────────────────────────────────────────────────────────────────┐
│                      INTERNET SIDE                               │
│  ┌──────────────┐         ┌─────────────────────────────────┐   │
│  │ ReleaseRadar │───────▶ │ @lvnt/release-radar-cli (npm)   │   │
│  │  (existing)  │ publish │ contains: versions.json         │   │
│  └──────────────┘         │ - tool names                    │   │
│                           │ - latest versions               │   │
│                           │ - download URLs with            │   │
│                           │   {{NEXUS_URL}} placeholder     │   │
│                           └─────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────┘
                                    │
                            npm registry
                                    │
                              Nexus proxy
                                    │
┌─────────────────────────────────────────────────────────────────┐
│                      INTRANET SIDE                               │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │ release-radar-cli                                        │    │
│  │ - Interactive TUI                                        │    │
│  │ - Replaces {{NEXUS_URL}} with configured value          │    │
│  │ - Executes wget to download selected tools              │    │
│  │ - Tracks downloaded versions locally                    │    │
│  └─────────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────────┘
```

## Data Formats

### versions.json (bundled in npm package)

Generated by ReleaseRadar, published with the CLI package:

```json
{
  "generatedAt": "2026-01-24T10:30:00Z",
  "tools": [
    {
      "name": "golang",
      "displayName": "Go",
      "version": "1.22.0",
      "publishedAt": "2026-01-20T00:00:00Z",
      "downloadUrl": "{{NEXUS_URL}}/github.com/golang/go/releases/download/go1.22.0/go1.22.0.linux-amd64.tar.gz",
      "filename": "go1.22.0.linux-amd64.tar.gz"
    },
    {
      "name": "nodejs",
      "displayName": "Node.js",
      "version": "20.11.0",
      "publishedAt": "2026-01-18T00:00:00Z",
      "downloadUrl": "{{NEXUS_URL}}/nodejs.org/dist/v20.11.0/node-v20.11.0-linux-x64.tar.xz",
      "filename": "node-v20.11.0-linux-x64.tar.xz"
    }
  ]
}
```

### downloads.json (ReleaseRadar config)

Separate configuration file mapping tools to download URL templates:

```json
{
  "golang": {
    "displayName": "Go",
    "downloadUrl": "github.com/golang/go/releases/download/go{{VERSION}}/go{{VERSION}}.linux-amd64.tar.gz",
    "filename": "go{{VERSION}}.linux-amd64.tar.gz"
  },
  "cmake": {
    "displayName": "CMake",
    "downloadUrl": "github.com/Kitware/CMake/releases/download/v{{VERSION}}/cmake-{{VERSION}}-linux-x86_64.tar.gz",
    "filename": "cmake-{{VERSION}}-linux-x86_64.tar.gz"
  },
  "vscode": {
    "displayName": "VS Code",
    "downloadUrl": "github.com/lvntbkdmr/my-tools-mirror/releases/download/vscode-{{VERSION}}/VSCode-linux-x64-{{VERSION}}.tar.gz",
    "filename": "VSCode-linux-x64-{{VERSION}}.tar.gz"
  }
}
```

This separates version detection (tools.json) from download configuration (downloads.json), since:
- Some tools are tracked from one source but downloaded from another
- Each tool has unique asset naming conventions
- Some tools may require manual mirroring to a personal repo

### CLI Local Storage (~/.release-radar-cli/)

```
~/.release-radar-cli/
├── config.json        # User configuration
└── downloaded.json    # Tracking what's been downloaded
```

**config.json:**
```json
{
  "nexusUrl": "http://nexus.company.local",
  "downloadDir": "~/downloads/tools"
}
```

**downloaded.json:**
```json
{
  "golang": {
    "version": "1.22.0",
    "downloadedAt": "2026-01-24T11:00:00Z",
    "filename": "go1.22.0.linux-amd64.tar.gz"
  },
  "nodejs": {
    "version": "20.11.0",
    "downloadedAt": "2026-01-20T09:30:00Z",
    "filename": "node-v20.11.0-linux-x64.tar.xz"
  }
}
```

## CLI User Experience

### First Run Setup

```
$ release-radar-cli

Welcome to release-radar-cli!

Let's configure your settings.

? Enter your Nexus proxy base URL: http://nexus.company.local
? Enter download directory: ~/downloads/tools

Configuration saved to ~/.release-radar-cli/config.json
```

### Interactive Menu

```
$ release-radar-cli

release-radar-cli v1.0.0
Last updated: 2026-01-24 10:30:00

  Tool           Latest      Downloaded   Status
─────────────────────────────────────────────────
◯ Go             1.22.0      1.21.0       UPDATE
◯ Node.js        20.11.0     20.11.0      ✓
◯ Rust           1.75.0      -            NEW
◯ kubectl        1.29.0      1.28.0       UPDATE

  ↑/↓: Navigate  Space: Select  Enter: Download  q: Quit

? Select tools to download:
```

### Download Execution

```
Downloading Go 1.22.0...
  wget http://nexus.company.local/github.com/golang/go/releases/download/go1.22.0/go1.22.0.linux-amd64.tar.gz
  Saved to ~/downloads/tools/go1.22.0.linux-amd64.tar.gz ✓

Downloading Rust 1.75.0...
  wget http://nexus.company.local/...
  Saved to ~/downloads/tools/rust-1.75.0-x86_64-unknown-linux-gnu.tar.gz ✓

Updated local tracking. Done!
```

### CLI Commands

- `release-radar-cli` - Opens interactive menu (main usage)
- `release-radar-cli config` - Re-run setup to change settings
- `release-radar-cli status` - Quick view of what needs updating (non-interactive)

## CLI Startup Flow

```
┌─────────────────────────────────────────────┐
│           release-radar-cli start           │
└─────────────────┬───────────────────────────┘
                  ▼
┌─────────────────────────────────────────────┐
│       First run? (no config exists)         │
│       Yes → Run interactive setup           │
└─────────────────┬───────────────────────────┘
                  ▼
┌─────────────────────────────────────────────┐
│     Check npm for newer version             │
│     (npm view @lvnt/release-radar-cli)      │
└─────────────────┬───────────────────────────┘
                  ▼
┌─────────────────────────────────────────────┐
│  Newer version?                             │
│  Yes → npm update -g → restart self → exit  │
└─────────────────┬───────────────────────────┘
                  ▼
┌─────────────────────────────────────────────┐
│     Load versions.json & downloaded.json    │
│     Show interactive menu                   │
└─────────────────────────────────────────────┘
```

The auto-update with restart ensures users always run with the latest versions.json data without manual intervention.

## Security

Download URLs use `{{NEXUS_URL}}` placeholder to avoid exposing corporate Nexus addresses in public repositories. The placeholder is replaced at runtime with the user's configured Nexus URL.

## Implementation Scope

### ReleaseRadar Changes

1. Add `config/downloads.json` for download URL templates
2. Generate `versions.json` by merging version data with download config
3. Publish `@lvnt/release-radar-cli` to npm when versions change

### release-radar-cli (New Package)

1. First-run interactive setup (Nexus URL, download directory)
2. Auto-update with restart on startup
3. Interactive TUI for tool selection
4. wget execution with `{{NEXUS_URL}}` replacement
5. Local tracking of downloaded versions

## Component Summary

| Component | Location | Purpose |
|-----------|----------|---------|
| `tools.json` | ReleaseRadar | What to monitor, how to detect versions |
| `downloads.json` | ReleaseRadar | Download URL templates per tool |
| `versions.json` | Published in CLI package | Merged version + download info |
| `@lvnt/release-radar-cli` | npm registry | The CLI + bundled versions.json |
| `~/.release-radar-cli/` | Intranet machine | Config + download tracking |

## Workflow

1. ReleaseRadar detects update → sends Telegram notification
2. ReleaseRadar regenerates `versions.json` (merging from both configs)
3. ReleaseRadar publishes new version of `@lvnt/release-radar-cli`
4. On intranet: run `release-radar-cli`
5. CLI auto-updates if needed → restarts
6. Interactive menu → select tools → wget downloads
